<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Relatórios - GYM CONTROL</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9fafb;
      padding: 2rem;
    }
    h1 {
      text-align: center;
      color: #1e3a8a;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      padding: 1rem;
      border-bottom: 1px solid #ddd;
      text-align: left;
    }
    th {
      background-color: #3b82f6;
      color: white;
    }
    tr:hover {
      background-color: #f1f5f9;
    }
    .btn {
      padding: 0.4rem 0.8rem;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      margin-right: 5px;
    }
    .btn-evadir {
      background-color: #ef4444;
      color: white;
    }
    .btn-evadir:disabled {
      background-color: #9ca3af;
      cursor: not-allowed;
    }
    .btn-voltar {
      display: inline-block;
      margin-top: 2rem;
      color: #3b82f6;
      text-decoration: none;
      font-weight: bold;
    }
    #filtroStatus {
      padding: 0.5rem;
      font-size: 1rem;
      margin-bottom: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>

  <h1>Relatórios de Alunos</h1>

  <label for="filtroStatus">Filtrar por status:</label>
  <select id="filtroStatus">
    <option value="todos">Todos</option>
    <option value="ativos">Ativos</option>
    <option value="evadidos">Evadidos</option>
  </select>

  <table>
    <thead>
      <tr>
        <th>Nome</th>
        <th>Email</th>
        <th>Telefone</th>
        <th>Status</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody id="tabelaAlunos"></tbody>
  </table>

  <a href="index.html" class="btn-voltar">← Voltar para Home</a>

  <script>
    // Função para carregar e exibir alunos
    function carregarAlunos() {
      const listaAlunos = JSON.parse(localStorage.getItem('listaAlunos')) || [];
      const filtro = document.getElementById('filtroStatus').value;
      const tbody = document.getElementById('tabelaAlunos');
      tbody.innerHTML = '';

      const alunosFiltrados = listaAlunos.filter(aluno => {
        if (filtro === 'ativos') return aluno.ativo === true;
        if (filtro === 'evadidos') return aluno.ativo === false;
        return true; // todos
      });

      if (alunosFiltrados.length === 0) {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td colspan="5" style="text-align:center;">Nenhum aluno encontrado.</td>`;
        tbody.appendChild(tr);
        return;
      }

      alunosFiltrados.forEach(aluno => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${aluno.nome}</td>
          <td>${aluno.email}</td>
          <td>${aluno.telefone}</td>
          <td>${aluno.ativo ? 'Ativo' : 'Evadido'}</td>
          <td>
            <button class="btn btn-evadir" onclick="marcarEvasao(${aluno.id})" ${aluno.ativo ? '' : 'disabled'}>
              Marcar Evasão
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Função para marcar evasão
    function marcarEvasao(id) {
      let listaAlunos = JSON.parse(localStorage.getItem('listaAlunos')) || [];
      let dadosAcademia = JSON.parse(localStorage.getItem('dadosAcademia')) || {
        totalAlunos: 0,
        alunosAtivos: 0,
        alunosEvadidos: 0
      };

      const index = listaAlunos.findIndex(aluno => aluno.id === id);
      if (index !== -1 && listaAlunos[index].ativo) {
        listaAlunos[index].ativo = false;

        // Atualiza dados da academia
        dadosAcademia.alunosAtivos = Math.max(dadosAcademia.alunosAtivos - 1, 0);
        dadosAcademia.alunosEvadidos += 1;

        // Salva atualizações
        localStorage.setItem('listaAlunos', JSON.stringify(listaAlunos));
        localStorage.setItem('dadosAcademia', JSON.stringify(dadosAcademia));

        alert(`Aluno ${listaAlunos[index].nome} marcado como evadido.`);
        carregarAlunos();
      }
    }

    // Evento para atualizar filtro
    document.getElementById('filtroStatus').addEventListener('change', carregarAlunos);

    // Carrega alunos ao abrir a página
    window.onload = carregarAlunos;
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Risco de Evas√£o - GYM CONTROL</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background: #f9fafb;
    margin: 0;
    padding: 1rem;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
  }
  h1 {
    text-align: center;
    color: #ef4444;
  }
  .aluno-card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 6px rgb(0 0 0 / 0.1);
    margin-bottom: 1rem;
    padding: 1rem;
    display: flex;
    flex-direction: column;
  }
  .aluno-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .aluno-nome {
    font-weight: 700;
    font-size: 1.2rem;
    color: #1f2937;
  }
  .aluno-frequencia {
    font-weight: 700;
    color: #f59e0b;
  }
  .aluno-ultima {
    font-size: 0.9rem;
    color: #6b7280;
  }
  label {
    font-weight: 600;
    margin-top: 0.5rem;
  }
  textarea {
    width: 100%;
    border-radius: 6px;
    border: 1px solid #d1d5db;
    padding: 0.5rem;
    resize: vertical;
    font-family: inherit;
    font-size: 0.95rem;
  }
  button {
    margin-top: 0.7rem;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 6px;
    background-color: #3b82f6;
    color: white;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.25s ease;
  }
  button:hover {
    background-color: #2563eb;
  }
  .promocao-btn {
    background-color: #10b981;
  }
  .promocao-btn:hover {
    background-color: #047857;
  }
  .chamou {
    background-color: #6b7280 !important;
    cursor: default !important;
  }
  .btns-container {
    margin-top: 0.5rem;
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  .grafico-container {
    max-width: 600px;
    margin: 2rem auto 1rem;
    background: white;
    border-radius: 10px;
    padding: 1rem;
    box-shadow: 0 1px 6px rgb(0 0 0 / 0.1);
  }
  #filtroBusca {
    width: 100%;
    padding: 0.5rem 1rem;
    font-size: 1rem;
    border-radius: 10px;
    border: 1px solid #94a3b8;
    margin-bottom: 1rem;
    outline-offset: 2px;
    outline-color: #3b82f6;
  }
</style>
</head>
<body>

<h1>Risco de Evas√£o - GYM CONTROL</h1>

<input type="text" id="filtroBusca" placeholder="Buscar aluno por nome..." />

<div id="listaAlunos"></div>

<div class="grafico-container">
  <canvas id="graficoFrequencia"></canvas>
</div>

<script>
  // Lista inicial de alunos (s√≥ cria se n√£o existir)
  function criarAlunosExemplo() {
    const exemploAlunos = [
      {nome:"Jo√£o Silva", telefone:"5511999998888", frequencia:30, ultimaPresenca:"2025-04-10", motivoFalta:"", interessePromocao:false, recuperado:false},
      {nome:"Maria Oliveira", telefone:"5511988887777", frequencia:65, ultimaPresenca:"2025-05-01", motivoFalta:"Problemas de sa√∫de", interessePromocao:true, recuperado:false},
      {nome:"Carlos Pereira", telefone:"5511977776666", frequencia:80, ultimaPresenca:"2025-05-20", motivoFalta:"", interessePromocao:false, recuperado:false},
      {nome:"Ana Souza", telefone:"5511966665555", frequencia:15, ultimaPresenca:"2025-03-20", motivoFalta:"Trabalho intenso", interessePromocao:true, recuperado:false},
      {nome:"Pedro Gomes", telefone:"5511955554444", frequencia:0, ultimaPresenca:"2025-01-15", motivoFalta:"", interessePromocao:false, recuperado:false},
      {nome:"Lucas Costa", telefone:"5511944443333", frequencia:50, ultimaPresenca:"2025-04-28", motivoFalta:"", interessePromocao:false, recuperado:true}
    ];
    localStorage.setItem('listaAlunos', JSON.stringify(exemploAlunos));
  }

  if (!localStorage.getItem('listaAlunos')) criarAlunosExemplo();

  // Fun√ß√£o para salvar lista atualizada
  function salvarAlunos(lista) {
    localStorage.setItem('listaAlunos', JSON.stringify(lista));
  }

  // Fun√ß√£o para abrir WhatsApp com mensagem personalizada
  function abrirWhatsApp(numero, nome) {
    const texto = encodeURIComponent(`Ol√° ${nome}, sentimos sua falta na academia! Que tal voltar com uma promo√ß√£o especial? Responda aqui para saber mais.`);
    window.open(`https://wa.me/${numero}?text=${texto}`, '_blank');
  }

  // Fun√ß√£o para renderizar lista de alunos com filtro
  function renderizarLista(filtro='') {
    const container = document.getElementById('listaAlunos');
    const listaAlunos = JSON.parse(localStorage.getItem('listaAlunos')) || [];

    // Filtra por nome
    const listaFiltrada = listaAlunos.filter(a => a.nome.toLowerCase().includes(filtro.toLowerCase()));

    container.innerHTML = '';
    if(listaFiltrada.length === 0){
      container.innerHTML = '<p style="text-align:center; color:#6b7280;">Nenhum aluno encontrado.</p>';
      return;
    }

    listaFiltrada.forEach((aluno, idx) => {
      const card = document.createElement('div');
      card.className = 'aluno-card';

      card.innerHTML = `
        <div class="aluno-header">
          <div>
            <div class="aluno-nome">${aluno.nome}</div>
            <div class="aluno-ultima">√öltima presen√ßa: ${aluno.ultimaPresenca}</div>
          </div>
          <div class="aluno-frequencia">${aluno.frequencia}%</div>
        </div>
        <label for="motivo-${idx}">Motivo da falta:</label>
        <textarea id="motivo-${idx}" placeholder="Descreva o motivo..." rows="2">${aluno.motivoFalta || ''}</textarea>
        <div class="btns-container">
          <button onclick="salvarMotivo(${idx})">Salvar Motivo</button>
          <button class="promocao-btn ${aluno.interessePromocao ? 'chamou' : ''}" onclick="togglePromocao(${idx}, this)">
            ${aluno.interessePromocao ? 'Promo√ß√£o solicitada ‚úì' : 'Enviar Promo√ß√£o'}
          </button>
          <button ${aluno.recuperado ? 'disabled class="chamou"' : ''} onclick="marcarRecuperado(${idx}, this)">
            ${aluno.recuperado ? 'Aluno recuperado ‚úì' : 'Marcar como Recuperado'}
          </button>
          <button onclick="abrirWhatsApp('${aluno.telefone}', '${aluno.nome}')">üì± Chamar no WhatsApp</button>
        </div>
      `;

      container.appendChild(card);
    });
  }

  // Salvar motivo da falta
  function salvarMotivo(index){
    const listaAlunos = JSON.parse(localStorage.getItem('listaAlunos'));
    const textarea = document.getElementById(`motivo-${index}`);
    listaAlunos[index].motivoFalta = textarea.value.trim();
    salvarAlunos(listaAlunos);
    alert('Motivo salvo!');
  }

  // Alternar interesse em promo√ß√£o
  function togglePromocao(index, btn){
    const listaAlunos = JSON.parse(localStorage.getItem('listaAlunos'));
    listaAlunos[index].interessePromocao = !listaAlunos[index].interessePromocao;
    salvarAlunos(listaAlunos);
    btn.classList.toggle('chamou');
    btn.textContent = listaAlunos[index].interessePromocao ? 'Promo√ß√£o solicitada ‚úì' : 'Enviar Promo√ß√£o';
  }

  // Marcar aluno como recuperado
  function marcarRecuperado(index, btn){
    const listaAlunos = JSON.parse(localStorage.getItem('listaAlunos'));
    listaAlunos[index].recuperado = true;
    salvarAlunos(listaAlunos);
    btn.disabled = true;
    btn.classList.add('chamou');
    btn.textContent = 'Aluno recuperado ‚úì';
    alert('Aluno marcado como recuperado!');
    renderizarLista(document.getElementById('filtroBusca').value);
  }

  // Gr√°fico de frequ√™ncia m√©dia dos alunos (baixa, m√©dia, alta)
  function criarGrafico() {
    const ctx = document.getElementById('graficoFrequencia').getContext('2d');
    const listaAlunos = JSON.parse(localStorage.getItem('listaAlunos'));

    // Categorizar alunos por frequ√™ncia
    let baixa = 0, media = 0, alta = 0;
    listaAlunos.forEach(a => {
      if (a.frequencia < 30) baixa++;
      else if (a.frequencia < 70) media++;
      else alta++;
    });

    if(window.graficoInstance) window.graficoInstance.destroy();

    window.graficoInstance = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ['Baixa (<30%)', 'M√©dia (30-69%)', 'Alta (‚â•70%)'],
        datasets: [{
          label: 'Frequ√™ncia dos alunos',
          data: [baixa, media, alta],
          backgroundColor: ['#ef4444', '#fbbf24', '#10b981'],
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'bottom'
          },
          title: {
            display: true,
            text: 'Distribui√ß√£o da frequ√™ncia dos alunos'
          }
        }
      }
    });
  }

  // Filtrar lista ao digitar
  document.getElementById('filtroBusca').addEventListener('input', e => {
    renderizarLista(e.target.value);
  });

  // Inicializa tudo
  renderizarLista();
  criarGrafico();

</script>
</body>
</html>
